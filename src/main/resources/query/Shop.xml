<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.red.xip.shop.mapper.ShopMapper">

	<select id ="selectDetailAccount"
			parameterType = "com.red.xip.shop.model.P_Shop"
			resultType="com.red.xip.shop.model.R_Shop">
	<![CDATA[
		SELECT  IFNULL(M.FIRST_NM, '') AS FIRST_NM,
                IFNULL(M.LAST_NM, '') AS LAST_NM,
                M.EMAIL AS EMAIL,
                
                CASE WHEN IFNULL(AD.USER_CD, '')= '' THEN 0 ELSE 1 END AS ADD_COUNT,  
                IFNULL(AD.ADD_LAST_NM, '') AS ADD_LAST_NM,
                IFNULL(AD.ADD_FIRST_NM, '') AS ADD_FIRST_NM,
                IFNULL(AD.PHONE, '') AS PHONE,
                IFNULL(AD.COMPANY, '') AS COMPANY,
                IFNULL(AD.ADD_1, '') AS ADD_1,
                IFNULL(AD.ADD_2, '') AS ADD_2,
                IFNULL(AD.CITY, '') AS CITY,
                IFNULL(AD.ADD_COUNTRY, '') AS ADD_COUNTRY,
                IFNULL(AD.STATE, '') AS STATE,
                IFNULL(AD.POSTAL_CD, '') AS POSTAL_CD
        FROM    XIP_USERS AS M
                LEFT OUTER JOIN ADDRESSES AS AD
                ON  M.USER_CD = AD.USER_CD
        WHERE   M.USER_CD = CAST(#{userCd}AS UNSIGNED)
        AND     M.EMAIL = #{email}
	]]>
	</select>
	
	<update id ="updateAccountInfoNm"
			parameterType = "com.red.xip.shop.model.P_Shop">
		UPDATE  XIP_USERS
		   SET  LAST_NM = #{lastNm},
		        FIRST_NM = #{firstNm}
		WHERE   USER_CD = CAST(#{userCd}AS UNSIGNED)
		AND     EMAIL= #{email}
	</update>
	
	<update id ="updateAccountInfoPw"
			parameterType = "com.red.xip.shop.model.P_Shop">
		UPDATE  XIP_USERS
		   SET  PW = #{newPw}
		WHERE   USER_CD = CAST(#{userCd}AS UNSIGNED)
		AND     EMAIL= #{email}
	</update>
	
	<select id="getPwCheck" 
		parameterType = "com.red.xip.shop.model.P_Shop"
		resultType="com.red.xip.shop.model.R_Shop">
	
		SELECT PW, EMAIL, USER_CD
		FROM   XIP_USERS
		WHERE  EMAIL = #{email}
		
	</select>
	
	<insert id="insertAdd" 
		parameterType = "com.red.xip.shop.model.P_Shop">
	 
		INSERT INTO ADDRESSES(
	        USER_CD,
	        ADD_LAST_NM,
	        ADD_FIRST_NM,
	        PHONE,
	        COMPANY,
	        ADD_1,
	        ADD_2,
	        CITY,
	        ADD_COUNTRY,
	        STATE,
	        POSTAL_CD,
	        CREAT_DT,
	        MODIFY_DT
	    )
	    VALUES (
	        CAST(#{userCd}AS UNSIGNED),
	        #{addLastNm},
	        #{addFirstNm},
	        #{phone},
	        #{company},
	        #{add1},
	        #{add2},
	        #{city},
	        #{addCountry},
	        #{state},
	        #{postalCd},
	        NOW(),
	        NOW()
	    )
	    ON DUPLICATE KEY UPDATE
	    ADD_LAST_NM = #{addLastNm},
        ADD_FIRST_NM = #{addFirstNm},
        PHONE = #{phone},
        COMPANY = #{company},
        ADD_1 = #{add1},
        ADD_2 = #{add2},
        CITY = #{city},
        ADD_COUNTRY = #{addCountry},
        STATE = #{state},
        POSTAL_CD = #{postalCd},
        MODIFY_DT = NOW();
	</insert>

	
</mapper>